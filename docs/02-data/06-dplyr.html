<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R Training: Precision Diagnostics - 06-dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">R Training: Precision Diagnostics</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../02-data/05-tidyverse.html">Topic 2: Working with Data</a></li><li class="breadcrumb-item"><a href="../02-data/06-dplyr.html">06: <code>dplyr</code></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Topic 1: Intro to R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-intro/00-tour.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">00: R &amp; RStudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-intro/01-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01: Packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-intro/02-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02: R Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-intro/03-datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03: Datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-intro/04-documents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04: Documents</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Topic 2: Working with Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-data/05-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05: The <code>tidyverse</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-data/06-dplyr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">06: <code>dplyr</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-data/07-tidyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">07: <code>tidyr</code></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Topic 3: Data Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-viz/08-grammar-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">08: The grammar of graphics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-viz/09-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">09: <code>ggplot2</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-viz/10-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10: Tables</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Topic 4: Case Study</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-case-study/11-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11: The Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-case-study/12-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12: Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#dplyr-common-data-operations" id="toc-dplyr-common-data-operations" class="nav-link active" data-scroll-target="#dplyr-common-data-operations"><code>dplyr</code> | Common data operations</a>
  <ul class="collapse">
  <li><a href="#agenda" id="toc-agenda" class="nav-link" data-scroll-target="#agenda">Agenda</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#philosophy" id="toc-philosophy" class="nav-link" data-scroll-target="#philosophy">Philosophy</a></li>
  </ul></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#nc-dot-fatal-crashes-in-north-carolina" id="toc-nc-dot-fatal-crashes-in-north-carolina" class="nav-link" data-scroll-target="#nc-dot-fatal-crashes-in-north-carolina">NC DOT Fatal Crashes in North Carolina</a></li>
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice">Practice</a></li>
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">Variables</a></li>
  <li><a href="#viewing-your-data" id="toc-viewing-your-data" class="nav-link" data-scroll-target="#viewing-your-data">Viewing your data</a></li>
  </ul></li>
  <li><a href="#dplyr" id="toc-dplyr" class="nav-link" data-scroll-target="#dplyr"><code>dplyr</code></a>
  <ul class="collapse">
  <li><a href="#a-grammar-of-data-manipulation" id="toc-a-grammar-of-data-manipulation" class="nav-link" data-scroll-target="#a-grammar-of-data-manipulation">A Grammar of Data Manipulation</a></li>
  <li><a href="#dplyr-rules-for-functions" id="toc-dplyr-rules-for-functions" class="nav-link" data-scroll-target="#dplyr-rules-for-functions"><strong><code>dplyr</code></strong> rules for functions</a></li>
  <li><a href="#general-syntax" id="toc-general-syntax" class="nav-link" data-scroll-target="#general-syntax">General syntax</a></li>
  <li><a href="#filter-rows-with-filter" id="toc-filter-rows-with-filter" class="nav-link" data-scroll-target="#filter-rows-with-filter">Filter rows with <code>filter</code></a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><code>filter</code></a></li>
  <li><a href="#filter-multiple-conditions" id="toc-filter-multiple-conditions" class="nav-link" data-scroll-target="#filter-multiple-conditions"><code>filter</code>: multiple conditions</a></li>
  <li><a href="#mutate-to-add-new-variables" id="toc-mutate-to-add-new-variables" class="nav-link" data-scroll-target="#mutate-to-add-new-variables"><code>mutate</code> to add new variables</a></li>
  <li><a href="#save-when-you-mutate" id="toc-save-when-you-mutate" class="nav-link" data-scroll-target="#save-when-you-mutate">“Save” when you <code>mutate</code></a></li>
  <li><a href="#practice-1" id="toc-practice-1" class="nav-link" data-scroll-target="#practice-1">Practice</a></li>
  <li><a href="#group_by-summarize" id="toc-group_by-summarize" class="nav-link" data-scroll-target="#group_by-summarize"><code>group_by</code> + <code>summarize</code></a></li>
  <li><a href="#cleaning-up-the-data" id="toc-cleaning-up-the-data" class="nav-link" data-scroll-target="#cleaning-up-the-data">Cleaning up the data…</a></li>
  <li><a href="#correct-and-overwrite-mutate" id="toc-correct-and-overwrite-mutate" class="nav-link" data-scroll-target="#correct-and-overwrite-mutate">Correct and overwrite <code>mutate</code></a></li>
  <li><a href="#check-before-you-move-on" id="toc-check-before-you-move-on" class="nav-link" data-scroll-target="#check-before-you-move-on">Check before you move on</a></li>
  <li><a href="#practice-2" id="toc-practice-2" class="nav-link" data-scroll-target="#practice-2">Practice</a></li>
  <li><a href="#slice-for-certain-row-numbers" id="toc-slice-for-certain-row-numbers" class="nav-link" data-scroll-target="#slice-for-certain-row-numbers"><code>slice</code> for certain row numbers</a></li>
  <li><a href="#select-to-keep-only-the-variables-you-mention" id="toc-select-to-keep-only-the-variables-you-mention" class="nav-link" data-scroll-target="#select-to-keep-only-the-variables-you-mention"><code>select</code> to keep only the variables you mention</a>
  <ul class="collapse">
  <li><a href="#or-select-to-exclude-variables" id="toc-or-select-to-exclude-variables" class="nav-link" data-scroll-target="#or-select-to-exclude-variables">or <code>select</code> to exclude variables</a></li>
  <li><a href="#or-select-a-range-of-variables" id="toc-or-select-a-range-of-variables" class="nav-link" data-scroll-target="#or-select-a-range-of-variables">or <code>select</code> a range of variables</a></li>
  </ul></li>
  <li><a href="#rename-specific-columns" id="toc-rename-specific-columns" class="nav-link" data-scroll-target="#rename-specific-columns"><code>rename</code> specific columns</a></li>
  <li><a href="#practice-3" id="toc-practice-3" class="nav-link" data-scroll-target="#practice-3">Practice</a></li>
  <li><a href="#arrange-to-order-rows" id="toc-arrange-to-order-rows" class="nav-link" data-scroll-target="#arrange-to-order-rows"><code>arrange</code> to order rows</a></li>
  <li><a href="#count-to-group-by-then-count" id="toc-count-to-group-by-then-count" class="nav-link" data-scroll-target="#count-to-group-by-then-count"><code>count</code> to group by then count</a></li>
  <li><a href="#distinct-to-filter-for-unique-rows" id="toc-distinct-to-filter-for-unique-rows" class="nav-link" data-scroll-target="#distinct-to-filter-for-unique-rows"><code>distinct</code> to filter for unique rows</a>
  <ul class="collapse">
  <li><a href="#distinct-has-a-.keep_all-parameter" id="toc-distinct-has-a-.keep_all-parameter" class="nav-link" data-scroll-target="#distinct-has-a-.keep_all-parameter"><code>distinct</code> has a .keep_all parameter</a></li>
  </ul></li>
  <li><a href="#practice-storms" id="toc-practice-storms" class="nav-link" data-scroll-target="#practice-storms">Practice: <code>storms</code></a></li>
  </ul></li>
  <li><a href="#calculating-common-metrics" id="toc-calculating-common-metrics" class="nav-link" data-scroll-target="#calculating-common-metrics">Calculating Common Metrics</a>
  <ul class="collapse">
  <li><a href="#data-1" id="toc-data-1" class="nav-link" data-scroll-target="#data-1">Data</a></li>
  <li><a href="#step-1-filter-data" id="toc-step-1-filter-data" class="nav-link" data-scroll-target="#step-1-filter-data">Step 1: Filter data</a></li>
  <li><a href="#step-2-calculate-ratios-practice" id="toc-step-2-calculate-ratios-practice" class="nav-link" data-scroll-target="#step-2-calculate-ratios-practice">Step 2: Calculate Ratios (Practice)</a></li>
  <li><a href="#step-3-calculate-intra-patient-cv" id="toc-step-3-calculate-intra-patient-cv" class="nav-link" data-scroll-target="#step-3-calculate-intra-patient-cv">Step 3: Calculate intra-patient CV</a></li>
  <li><a href="#step-4-identify-extreme-values" id="toc-step-4-identify-extreme-values" class="nav-link" data-scroll-target="#step-4-identify-extreme-values">Step 4: Identify extreme values</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="06-dplyr-reveal.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../02-data/05-tidyverse.html">Topic 2: Working with Data</a></li><li class="breadcrumb-item"><a href="../02-data/06-dplyr.html">06: <code>dplyr</code></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">06-dplyr</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="dplyr-common-data-operations" class="level1 page-columns page-full" data-background-color="#e4282e">
<h1 data-background-color="#e4282e"><code>dplyr</code> | Common data operations</h1>
<section id="agenda" class="level2">
<h2 class="anchored" data-anchor-id="agenda">Agenda</h2>
<p><code>dplyr</code></p>
<ol type="1">
<li>philosophy</li>
<li>common operations</li>
<li>Practice!</li>
</ol>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
</section>
<section id="philosophy" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="philosophy">Philosophy</h2>
<blockquote class="blockquote">
<p><code>dplyr</code> is a grammar of data manipulation, providing a consistent set of verbs that help you solve the most common data manipulation challenges</p>
</blockquote>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Source: <a href="https://dplyr.tidyverse.org/">dplyr.tidyverse.org</a></p>
</div></div></section>
</section>
<section id="data" class="level1 page-columns page-full" data-background-color="#e4282e">
<h1 data-background-color="#e4282e">Data</h1>
<section id="nc-dot-fatal-crashes-in-north-carolina" class="level2">
<h2 class="anchored" data-anchor-id="nc-dot-fatal-crashes-in-north-carolina">NC DOT Fatal Crashes in North Carolina</h2>
<p>To get practice with common data manipulations, we’ll use data from OpenDurham’s Data Portal.</p>
<p>. . .</p>
<p>To do so, we’ll read the file into R, using the function <code>read_csv2</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>bike <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">"https://raw.githubusercontent.com/COGS137/datasets/main/nc_bike_crash.csv"</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na =</span> <span class="fu">c</span>(<span class="st">"NA"</span>, <span class="st">""</span>, <span class="st">"."</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<p>Note: here we’re using a file called <code>read_csv2</code>. This is used for datasets that use ; for the separator and , for the decimal place (common in some European countries). <code>read_csv()</code> will be used more commonly.</p>
</section>
<section id="practice" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="practice">Practice</h2>
<p>Read the dataset in and determine how many observations and variables there are in the <code>bike</code> dataset.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Unmute to ask or put any questions in the chat. When completed, respond to the zoom poll.</p>
</div></div></section>
<section id="variables" class="level2">
<h2 class="anchored" data-anchor-id="variables">Variables</h2>
<p>View the names of variables via:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bike)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "FID"        "OBJECTID"   "AmbulanceR" "BikeAge_Gr" "Bike_Age"  
 [6] "Bike_Alc_D" "Bike_Dir"   "Bike_Injur" "Bike_Pos"   "Bike_Race" 
[11] "Bike_Sex"   "City"       "County"     "CrashAlcoh" "CrashDay"  
[16] "Crash_Date" "Crash_Grp"  "Crash_Hour" "Crash_Loc"  "Crash_Mont"
[21] "Crash_Time" "Crash_Type" "Crash_Ty_1" "Crash_Year" "Crsh_Sevri"
[26] "Developmen" "DrvrAge_Gr" "Drvr_Age"   "Drvr_Alc_D" "Drvr_EstSp"
[31] "Drvr_Injur" "Drvr_Race"  "Drvr_Sex"   "Drvr_VehTy" "ExcsSpdInd"
[36] "Hit_Run"    "Light_Cond" "Locality"   "Num_Lanes"  "Num_Units" 
[41] "Rd_Charact" "Rd_Class"   "Rd_Conditi" "Rd_Config"  "Rd_Defects"
[46] "Rd_Feature" "Rd_Surface" "Region"     "Rural_Urba" "Speed_Limi"
[51] "Traff_Cntr" "Weather"    "Workzone_I" "Location"  </code></pre>
</div>
</div>
</section>
<section id="viewing-your-data" class="level2">
<h2 class="anchored" data-anchor-id="viewing-your-data">Viewing your data</h2>
<ul>
<li>In the Environment, click on the name of the data frame to view it in the data viewer (or use the <code>View</code> function)</li>
</ul>
<p>. . .</p>
<ul>
<li>Use the <code>glimpse</code> function to take a peek</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(bike)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,716
Columns: 54
$ FID        &lt;dbl&gt; 18, 29, 33, 35, 49, 53, 56, 60, 63, 66, 72, 75, 82, 84, 85,…
$ OBJECTID   &lt;dbl&gt; 19, 30, 34, 36, 50, 54, 57, 61, 64, 67, 73, 76, 83, 85, 86,…
$ AmbulanceR &lt;chr&gt; "No", "Yes", "No", "Yes", "No", "Yes", "Yes", "No", "Yes", …
$ BikeAge_Gr &lt;chr&gt; NA, "50-59", NA, "16-19", NA, "50-59", "16-19", "40-49", "1…
$ Bike_Age   &lt;dbl&gt; 6, 51, 10, 17, 6, 52, 18, 40, 6, 7, 45, 30, 17, 20, 14, 15,…
$ Bike_Alc_D &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ Bike_Dir   &lt;chr&gt; "Not Applicable", "With Traffic", "With Traffic", NA, "Faci…
$ Bike_Injur &lt;chr&gt; "C: Possible Injury", "C: Possible Injury", "Injury", "B: E…
$ Bike_Pos   &lt;chr&gt; "Driveway / Alley", "Travel Lane", "Travel Lane", "Travel L…
$ Bike_Race  &lt;chr&gt; "Black", "Black", "Black", "White", "Black", "White", "Blac…
$ Bike_Sex   &lt;chr&gt; "Female", "Male", "Male", "Male", "Male", "Male", "Female",…
$ City       &lt;chr&gt; "Durham", "Greenville", "Farmville", "Charlotte", "Charlott…
$ County     &lt;chr&gt; "Durham", "Pitt", "Pitt", "Mecklenburg", "Mecklenburg", "Du…
$ CrashAlcoh &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ CrashDay   &lt;chr&gt; "01-01-06", "01-01-02", "01-01-07", "01-01-05", NA, NA, NA,…
$ Crash_Date &lt;date&gt; 2007-01-06, 2007-01-09, 2007-01-14, 2007-01-12, 2007-01-15…
$ Crash_Grp  &lt;chr&gt; "Bicyclist Failed to Yield - Midblock", "Crossing Paths - O…
$ Crash_Hour &lt;dbl&gt; 13, 23, 16, 19, 12, 20, 19, 14, 16, 0, 17, 18, 14, 17, 19, …
$ Crash_Loc  &lt;chr&gt; "Non-Intersection", "Intersection-Related", "Intersection",…
$ Crash_Mont &lt;chr&gt; NA, NA, NA, NA, NA, "01-04-01", "01-04-01", NA, "01-02-01",…
$ Crash_Time &lt;dttm&gt; 0001-01-01 13:17:58, 0001-01-01 23:08:58, 0001-01-01 16:44…
$ Crash_Type &lt;chr&gt; "Bicyclist Ride Out - Residential Driveway", "Crossing Path…
$ Crash_Ty_1 &lt;dbl&gt; 353311, 211180, 111144, 119139, 112114, 311231, 119144, 132…
$ Crash_Year &lt;dbl&gt; 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007,…
$ Crsh_Sevri &lt;chr&gt; "C: Possible Injury", "C: Possible Injury", "O: No Injury",…
$ Developmen &lt;chr&gt; "Residential", "Commercial", "Residential", "Residential", …
$ DrvrAge_Gr &lt;chr&gt; "60-69", "30-39", "50-59", "30-39", NA, "20-24", "40-49", N…
$ Drvr_Age   &lt;dbl&gt; 66, 34, 52, 33, NA, 20, 40, NA, 17, 51, NA, 64, 50, 66, 30,…
$ Drvr_Alc_D &lt;chr&gt; "No", "No", "No", "No", "Missing", "No", "No", "Missing", "…
$ Drvr_EstSp &lt;chr&gt; "11-15 mph", "0-5 mph", "21-25 mph", "46-50 mph", "16-20 mp…
$ Drvr_Injur &lt;chr&gt; "O: No Injury", "O: No Injury", "O: No Injury", "O: No Inju…
$ Drvr_Race  &lt;chr&gt; "Black", "Black", "White", "White", "/Missing", "White", "B…
$ Drvr_Sex   &lt;chr&gt; "Male", "Male", "Female", "Female", NA, "Female", "Male", N…
$ Drvr_VehTy &lt;chr&gt; "Pickup", "Passenger Car", "Passenger Car", "Sport Utility"…
$ ExcsSpdInd &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ Hit_Run    &lt;chr&gt; "No", "No", "No", "No", "Yes", "No", "No", "Yes", "No", "No…
$ Light_Cond &lt;chr&gt; "Daylight", "Dark - Lighted Roadway", "Daylight", "Dark - R…
$ Locality   &lt;chr&gt; "Mixed (30% To 70% Developed)", "Urban (&gt;70% Developed)", "…
$ Num_Lanes  &lt;chr&gt; "2 lanes", "5 lanes", "2 lanes", "4 lanes", "2 lanes", "4 l…
$ Num_Units  &lt;dbl&gt; 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,…
$ Rd_Charact &lt;chr&gt; "Straight - Level", "Straight - Level", "Straight - Level",…
$ Rd_Class   &lt;chr&gt; "Local Street", "Local Street", "Local Street", "NC Route",…
$ Rd_Conditi &lt;chr&gt; "Dry", "Dry", "Dry", "Dry", "Dry", "Dry", "Dry", "Dry", "Dr…
$ Rd_Config  &lt;chr&gt; "Two-Way, Not Divided", "Two-Way, Divided, Unprotected Medi…
$ Rd_Defects &lt;chr&gt; "None", "None", "None", "None", "None", "None", "None", "No…
$ Rd_Feature &lt;chr&gt; "No Special Feature", "Four-Way Intersection", "Four-Way In…
$ Rd_Surface &lt;chr&gt; "Smooth Asphalt", "Smooth Asphalt", "Smooth Asphalt", "Smoo…
$ Region     &lt;chr&gt; "Piedmont", "Coastal", "Coastal", "Piedmont", "Piedmont", "…
$ Rural_Urba &lt;chr&gt; "Urban", "Urban", "Rural", "Urban", "Urban", "Urban", "Urba…
$ Speed_Limi &lt;chr&gt; "20 - 25  MPH", "40 - 45  MPH", "30 - 35  MPH", "40 - 45  M…
$ Traff_Cntr &lt;chr&gt; "No Control Present", "Stop And Go Signal", "Stop Sign", "S…
$ Weather    &lt;chr&gt; "Clear", "Clear", "Clear", "Cloudy", "Clear", "Clear", "Cle…
$ Workzone_I &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No", "No",…
$ Location   &lt;chr&gt; "36.002743, -78.8785", "35.612984, -77.39265", "35.595676, …</code></pre>
</div>
</div>
<p>. . .</p>
<ul>
<li>Use the <code>skim</code> function to get a sense of the data we have</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(bike)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="dplyr" class="level1 page-columns page-full" data-background-color="#e4282e">
<h1 data-background-color="#e4282e"><code>dplyr</code></h1>
<section id="a-grammar-of-data-manipulation" class="level2 smaller scrollable">
<h2 class="smaller scrollable anchored" data-anchor-id="a-grammar-of-data-manipulation">A Grammar of Data Manipulation</h2>
<p><strong>dplyr</strong> is based on the concepts of functions as verbs that manipulate data frames.</p>
<p>Single data frame functions / verbs:</p>
<ul>
<li><code>filter</code>: pick rows matching criteria</li>
<li><code>slice</code>: pick rows using index(es)</li>
<li><code>select</code>: pick columns by name</li>
<li><code>rename</code>: rename specific columns</li>
<li><code>arrange</code>: reorder rows</li>
<li><code>mutate</code>: add new variables</li>
<li><code>case_when</code>: for conditional assignment</li>
<li><code>distinct</code>: filter for unique rows</li>
<li><code>group_by</code>: for carrying out operations within groups of data</li>
<li><code>summarize</code>: reduce variables to values</li>
<li>… (many more)</li>
</ul>
</section>
<section id="dplyr-rules-for-functions" class="level2">
<h2 class="anchored" data-anchor-id="dplyr-rules-for-functions"><strong><code>dplyr</code></strong> rules for functions</h2>
<ol type="1">
<li><p>First argument is <em>always</em> a data frame</p></li>
<li><p>Subsequent arguments say what to do with that data frame</p></li>
<li><p>Always return a data frame</p></li>
<li><p>Do not modify in place</p></li>
<li><p>Performance via lazy evaluation</p></li>
</ol>
</section>
<section id="general-syntax" class="level2">
<h2 class="anchored" data-anchor-id="general-syntax">General syntax</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">verb</span>(...) <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">next_verb</span>(...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filter-rows-with-filter" class="level2">
<h2 class="anchored" data-anchor-id="filter-rows-with-filter">Filter rows with <code>filter</code></h2>
<ul>
<li>Select a subset of rows in a data frame.</li>
<li>Easily filter for many conditions at once.</li>
</ul>
</section>
<section id="filter" class="level2">
<h2 class="anchored" data-anchor-id="filter"><code>filter</code></h2>
<p>for crashes in Durham County</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">filter</span>(County <span class="sc">==</span> <span class="st">"Durham"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 253 × 54
     FID OBJECTID AmbulanceR BikeAge_Gr Bike_Age Bike_Alc_D Bike_Dir  Bike_Injur
   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     
 1    18       19 No         &lt;NA&gt;              6 No         Not Appl… C: Possib…
 2    53       54 Yes        50-59            52 No         With Tra… A: Disabl…
 3    56       57 Yes        16-19            18 No         &lt;NA&gt;      C: Possib…
 4   209      210 No         16-19            16 No         Facing T… C: Possib…
 5   228      229 Yes        40-49            40 No         With Tra… B: Eviden…
 6   620      621 Yes        50-59            55 No         With Tra… B: Eviden…
 7   667      668 Yes        60-69            61 No         Not Appl… B: Eviden…
 8   458      459 Yes        60-69            62 No         With Tra… B: Eviden…
 9   576      577 No         40-49            49 No         With Tra… C: Possib…
10   618      619 No         20-24            23 No         With Tra… C: Possib…
# ℹ 243 more rows
# ℹ 46 more variables: Bike_Pos &lt;chr&gt;, Bike_Race &lt;chr&gt;, Bike_Sex &lt;chr&gt;,
#   City &lt;chr&gt;, County &lt;chr&gt;, CrashAlcoh &lt;chr&gt;, CrashDay &lt;chr&gt;,
#   Crash_Date &lt;date&gt;, Crash_Grp &lt;chr&gt;, Crash_Hour &lt;dbl&gt;, Crash_Loc &lt;chr&gt;,
#   Crash_Mont &lt;chr&gt;, Crash_Time &lt;dttm&gt;, Crash_Type &lt;chr&gt;, Crash_Ty_1 &lt;dbl&gt;,
#   Crash_Year &lt;dbl&gt;, Crsh_Sevri &lt;chr&gt;, Developmen &lt;chr&gt;, DrvrAge_Gr &lt;chr&gt;,
#   Drvr_Age &lt;dbl&gt;, Drvr_Alc_D &lt;chr&gt;, Drvr_EstSp &lt;chr&gt;, Drvr_Injur &lt;chr&gt;, …</code></pre>
</div>
</div>
</section>
<section id="filter-multiple-conditions" class="level2">
<h2 class="anchored" data-anchor-id="filter-multiple-conditions"><code>filter</code>: multiple conditions</h2>
<p>for crashes in Durham County where biker was &lt; 10 yrs old</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">filter</span>(County <span class="sc">==</span> <span class="st">"Durham"</span>, Bike_Age <span class="sc">&lt;</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 54
     FID OBJECTID AmbulanceR BikeAge_Gr Bike_Age Bike_Alc_D Bike_Dir  Bike_Injur
   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     
 1    18       19 No         &lt;NA&gt;              6 No         Not Appl… C: Possib…
 2    47       48 No         10-Jun            9 No         Not Appl… O: No Inj…
 3   124      125 Yes        10-Jun            8 No         With Tra… C: Possib…
 4   531      532 Yes        10-Jun            7 No         With Tra… C: Possib…
 5   704      705 Yes        10-Jun            9 No         Not Appl… C: Possib…
 6    42       43 No         10-Jun            8 No         With Tra… O: No Inj…
 7   392      393 Yes        0-5               2 No         Not Appl… B: Eviden…
 8   941      942 No         10-Jun            9 No         With Tra… C: Possib…
 9   436      437 Yes        10-Jun            6 No         Not Appl… O: No Inj…
10   160      161 Yes        10-Jun            7 No         With Tra… C: Possib…
11   273      274 Yes        10-Jun            7 No         Facing T… C: Possib…
12    78       79 Yes        10-Jun            7 No         With Tra… C: Possib…
13   422      423 No         10-Jun            9 No         Not Appl… O: No Inj…
14   570      571 No         &lt;NA&gt;              0 Missing    Not Appl… Injury    
15   683      684 Yes        10-Jun            8 No         Not Appl… C: Possib…
16    62       63 Yes        10-Jun            7 No         With Tra… C: Possib…
17   248      249 No         0-5               4 No         Not Appl… O: No Inj…
18   306      307 Yes        10-Jun            8 No         With Tra… C: Possib…
19   231      232 Yes        10-Jun            8 No         With Tra… C: Possib…
20   361      362 Yes        10-Jun            9 No         With Tra… B: Eviden…
# ℹ 46 more variables: Bike_Pos &lt;chr&gt;, Bike_Race &lt;chr&gt;, Bike_Sex &lt;chr&gt;,
#   City &lt;chr&gt;, County &lt;chr&gt;, CrashAlcoh &lt;chr&gt;, CrashDay &lt;chr&gt;,
#   Crash_Date &lt;date&gt;, Crash_Grp &lt;chr&gt;, Crash_Hour &lt;dbl&gt;, Crash_Loc &lt;chr&gt;,
#   Crash_Mont &lt;chr&gt;, Crash_Time &lt;dttm&gt;, Crash_Type &lt;chr&gt;, Crash_Ty_1 &lt;dbl&gt;,
#   Crash_Year &lt;dbl&gt;, Crsh_Sevri &lt;chr&gt;, Developmen &lt;chr&gt;, DrvrAge_Gr &lt;chr&gt;,
#   Drvr_Age &lt;dbl&gt;, Drvr_Alc_D &lt;chr&gt;, Drvr_EstSp &lt;chr&gt;, Drvr_Injur &lt;chr&gt;,
#   Drvr_Race &lt;chr&gt;, Drvr_Sex &lt;chr&gt;, Drvr_VehTy &lt;chr&gt;, ExcsSpdInd &lt;chr&gt;, …</code></pre>
</div>
</div>
</section>
<section id="mutate-to-add-new-variables" class="level2">
<h2 class="anchored" data-anchor-id="mutate-to-add-new-variables"><code>mutate</code> to add new variables</h2>
<p><span style="background-color: #ADD8E6"><i class="fa fa-user" aria-hidden="true"></i> &nbsp; How is the new <code>alcohol</code> variable determined?</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alcohol =</span> <span class="fu">case_when</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    Bike_Alc_D <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> Drvr_Alc_D <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">~</span> <span class="st">"No"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    Bike_Alc_D <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> Drvr_Alc_D <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    Bike_Alc_D <span class="sc">==</span> <span class="st">"Missing"</span> <span class="sc">&amp;</span> Drvr_Alc_D <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">~</span> <span class="st">"Missing"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    Bike_Alc_D <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> Drvr_Alc_D <span class="sc">==</span> <span class="st">"Missing"</span> <span class="sc">~</span> <span class="st">"Missing"</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="save-when-you-mutate" class="level2">
<h2 class="anchored" data-anchor-id="save-when-you-mutate">“Save” when you <code>mutate</code></h2>
<p>Most often when you define a new variable with <code>mutate</code> you’ll also want to store the resulting data frame, often by writing over the original data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>bike <span class="ot">&lt;-</span> bike <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alcohol =</span> <span class="fu">case_when</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    Bike_Alc_D <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> Drvr_Alc_D <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">~</span> <span class="st">"No"</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    Bike_Alc_D <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> Drvr_Alc_D <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    Bike_Alc_D <span class="sc">==</span> <span class="st">"Missing"</span> <span class="sc">&amp;</span> Drvr_Alc_D <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">~</span> <span class="st">"Missing"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    Bike_Alc_D <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> Drvr_Alc_D <span class="sc">==</span> <span class="st">"Missing"</span> <span class="sc">~</span> <span class="st">"Missing"</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="practice-1" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="practice-1">Practice</h2>
<p>How many accidents in our dataset required an ambulance ride (<code>AmbulanceR</code>) <em>and</em> had the <code>Crash_Type</code> “Bicyclist Lost Control - Mechanical Problems”?</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Unmute to ask or put any questions in the chat. When completed, respond to the zoom poll.</p>
</div></div></section>
<section id="group_by-summarize" class="level2">
<h2 class="anchored" data-anchor-id="group_by-summarize"><code>group_by</code> + <code>summarize</code></h2>
<p>Real data are messy…</p>
<p><span style="background-color: #ADD8E6"><i class="fa fa-user" aria-hidden="true"></i> &nbsp; What does a <code>BikeAge_gr</code> of <code>10-Jun</code> or <code>15-Nov</code> mean?</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(BikeAge_Gr) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">crash_count =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 2
   BikeAge_Gr crash_count
   &lt;chr&gt;            &lt;int&gt;
 1 0-5                 60
 2 10-Jun             421
 3 15-Nov             747
 4 16-19              605
 5 20-24              680
 6 25-29              430
 7 30-39              658
 8 40-49              920
 9 50-59              739
10 60-69              274
11 70                  12
12 70+                 58
13 &lt;NA&gt;               112</code></pre>
</div>
</div>
<p>Note: <code>summarize</code> is <em>not</em> limited to counting how many observations there are. The median, mean, min, max, etc. can all be <code>summarize</code>d…and you can summarize more than one thing at a time.</p>
<p>. . .</p>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(BikeAge_Gr) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">crash_count =</span> <span class="fu">n</span>(), </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean =</span> <span class="fu">mean</span>(Bike_Age, <span class="at">na.rm=</span><span class="cn">TRUE</span>), </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">median</span>(Bike_Age, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 4
   BikeAge_Gr crash_count   mean median
   &lt;chr&gt;            &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 0-5                 60   4.02      4
 2 10-Jun             421   8.23      8
 3 15-Nov             747  13.2      13
 4 16-19              605  17.5      18
 5 20-24              680  21.7      22
 6 25-29              430  26.8      27
 7 30-39              658  34.4      35
 8 40-49              920  44.8      45
 9 50-59              739  53.6      53
10 60-69              274  63.4      63
11 70                  12   0         0
12 70+                 58 NaN        NA
13 &lt;NA&gt;               112   3.62      0</code></pre>
</div>
</div>
<ul>
<li><code>na.rm = TRUE</code> specifies to remote any NA values so you can still calculate the mean</li>
</ul>
</section>
<section id="cleaning-up-the-data" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-up-the-data">Cleaning up the data…</h2>
<ul>
<li>We’re going to need to do some text parsing to clean up these data
<ul>
<li><code>10-Jun</code> should be <code>6-10</code></li>
<li><code>15-Nov</code> should be <code>11-15</code></li>
</ul></li>
</ul>
</section>
<section id="correct-and-overwrite-mutate" class="level2 scrollable">
<h2 class="scrollable anchored" data-anchor-id="correct-and-overwrite-mutate">Correct and overwrite <code>mutate</code></h2>
<ul>
<li>Remember we want to do the following in the <code>BikeAge_Gr</code> variable
<ul>
<li><code>10-Jun</code> should be <code>6-10</code></li>
<li><code>15-Nov</code> should be <code>11-15</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>bike <span class="ot">&lt;-</span> bike <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">mutate</span>(<span class="at">BikeAge_Gr =</span> <span class="fu">case_when</span>(BikeAge_Gr <span class="sc">==</span> <span class="st">"10-Jun"</span> <span class="sc">~</span> <span class="st">"6-10"</span>,</span>
<span id="cb20-3"><a href="#cb20-3"></a>                                BikeAge_Gr <span class="sc">==</span> <span class="st">"15-Nov"</span> <span class="sc">~</span> <span class="st">"11-15"</span>,</span>
<span id="cb20-4"><a href="#cb20-4"></a>                                <span class="at">.default =</span> BikeAge_Gr     <span class="co"># everything else</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-before-you-move-on" class="level2">
<h2 class="anchored" data-anchor-id="check-before-you-move-on">Check before you move on</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(BikeAge_Gr) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 2
   BikeAge_Gr count
   &lt;chr&gt;      &lt;int&gt;
 1 0-5           60
 2 11-15        747
 3 16-19        605
 4 20-24        680
 5 25-29        430
 6 30-39        658
 7 40-49        920
 8 50-59        739
 9 6-10         421
10 60-69        274
11 70            12
12 70+           58
13 &lt;NA&gt;         112</code></pre>
</div>
</div>
</section>
<section id="practice-2" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="practice-2">Practice</h2>
<p>Did the average biker age (<code>Bike_Age</code>) differ between bike crashes that did and did not involve an Ambulance <code>AmbulanceR</code>?</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Unmute to ask or put any questions in the chat. When completed, respond to the zoom poll.</p>
</div></div></section>
<section id="slice-for-certain-row-numbers" class="level2">
<h2 class="anchored" data-anchor-id="slice-for-certain-row-numbers"><code>slice</code> for certain row numbers</h2>
<p>First five</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 54
    FID OBJECTID AmbulanceR BikeAge_Gr Bike_Age Bike_Alc_D Bike_Dir   Bike_Injur
  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
1    18       19 No         &lt;NA&gt;              6 No         Not Appli… C: Possib…
2    29       30 Yes        50-59            51 No         With Traf… C: Possib…
3    33       34 No         &lt;NA&gt;             10 No         With Traf… Injury    
4    35       36 Yes        16-19            17 No         &lt;NA&gt;       B: Eviden…
5    49       50 No         &lt;NA&gt;              6 No         Facing Tr… O: No Inj…
# ℹ 46 more variables: Bike_Pos &lt;chr&gt;, Bike_Race &lt;chr&gt;, Bike_Sex &lt;chr&gt;,
#   City &lt;chr&gt;, County &lt;chr&gt;, CrashAlcoh &lt;chr&gt;, CrashDay &lt;chr&gt;,
#   Crash_Date &lt;date&gt;, Crash_Grp &lt;chr&gt;, Crash_Hour &lt;dbl&gt;, Crash_Loc &lt;chr&gt;,
#   Crash_Mont &lt;chr&gt;, Crash_Time &lt;dttm&gt;, Crash_Type &lt;chr&gt;, Crash_Ty_1 &lt;dbl&gt;,
#   Crash_Year &lt;dbl&gt;, Crsh_Sevri &lt;chr&gt;, Developmen &lt;chr&gt;, DrvrAge_Gr &lt;chr&gt;,
#   Drvr_Age &lt;dbl&gt;, Drvr_Alc_D &lt;chr&gt;, Drvr_EstSp &lt;chr&gt;, Drvr_Injur &lt;chr&gt;,
#   Drvr_Race &lt;chr&gt;, Drvr_Sex &lt;chr&gt;, Drvr_VehTy &lt;chr&gt;, ExcsSpdInd &lt;chr&gt;, …</code></pre>
</div>
</div>
</section>
<section id="select-to-keep-only-the-variables-you-mention" class="level2">
<h2 class="anchored" data-anchor-id="select-to-keep-only-the-variables-you-mention"><code>select</code> to keep only the variables you mention</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">select</span>(Crash_Loc, Hit_Run)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,716 × 2
   Crash_Loc            Hit_Run
   &lt;chr&gt;                &lt;chr&gt;  
 1 Non-Intersection     No     
 2 Intersection-Related No     
 3 Intersection         No     
 4 Intersection         No     
 5 Intersection         Yes    
 6 Non-Intersection     No     
 7 Intersection         No     
 8 Intersection         Yes    
 9 Intersection         No     
10 Non-Roadway          No     
# ℹ 5,706 more rows</code></pre>
</div>
</div>
<p>. . .</p>
<section id="or-select-to-exclude-variables" class="level3">
<h3 class="anchored" data-anchor-id="or-select-to-exclude-variables">or <code>select</code> to exclude variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">select</span>(<span class="sc">-</span>OBJECTID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,716 × 53
     FID AmbulanceR BikeAge_Gr Bike_Age Bike_Alc_D Bike_Dir  Bike_Injur Bike_Pos
   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;   
 1    18 No         &lt;NA&gt;              6 No         Not Appl… C: Possib… Drivewa…
 2    29 Yes        50-59            51 No         With Tra… C: Possib… Travel …
 3    33 No         &lt;NA&gt;             10 No         With Tra… Injury     Travel …
 4    35 Yes        16-19            17 No         &lt;NA&gt;      B: Eviden… Travel …
 5    49 No         &lt;NA&gt;              6 No         Facing T… O: No Inj… Travel …
 6    53 Yes        50-59            52 No         With Tra… A: Disabl… Travel …
 7    56 Yes        16-19            18 No         &lt;NA&gt;      C: Possib… Travel …
 8    60 No         40-49            40 No         Facing T… B: Eviden… Sidewal…
 9    63 Yes        6-10              6 No         Facing T… B: Eviden… Travel …
10    66 Yes        6-10              7 No         &lt;NA&gt;      B: Eviden… Non-Roa…
# ℹ 5,706 more rows
# ℹ 45 more variables: Bike_Race &lt;chr&gt;, Bike_Sex &lt;chr&gt;, City &lt;chr&gt;,
#   County &lt;chr&gt;, CrashAlcoh &lt;chr&gt;, CrashDay &lt;chr&gt;, Crash_Date &lt;date&gt;,
#   Crash_Grp &lt;chr&gt;, Crash_Hour &lt;dbl&gt;, Crash_Loc &lt;chr&gt;, Crash_Mont &lt;chr&gt;,
#   Crash_Time &lt;dttm&gt;, Crash_Type &lt;chr&gt;, Crash_Ty_1 &lt;dbl&gt;, Crash_Year &lt;dbl&gt;,
#   Crsh_Sevri &lt;chr&gt;, Developmen &lt;chr&gt;, DrvrAge_Gr &lt;chr&gt;, Drvr_Age &lt;dbl&gt;,
#   Drvr_Alc_D &lt;chr&gt;, Drvr_EstSp &lt;chr&gt;, Drvr_Injur &lt;chr&gt;, Drvr_Race &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>. . .</p>
</section>
<section id="or-select-a-range-of-variables" class="level3">
<h3 class="anchored" data-anchor-id="or-select-a-range-of-variables">or <code>select</code> a range of variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">select</span>(OBJECTID<span class="sc">:</span>Bike_Injur)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,716 × 7
   OBJECTID AmbulanceR BikeAge_Gr Bike_Age Bike_Alc_D Bike_Dir       Bike_Injur 
      &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt;      
 1       19 No         &lt;NA&gt;              6 No         Not Applicable C: Possibl…
 2       30 Yes        50-59            51 No         With Traffic   C: Possibl…
 3       34 No         &lt;NA&gt;             10 No         With Traffic   Injury     
 4       36 Yes        16-19            17 No         &lt;NA&gt;           B: Evident…
 5       50 No         &lt;NA&gt;              6 No         Facing Traffic O: No Inju…
 6       54 Yes        50-59            52 No         With Traffic   A: Disabli…
 7       57 Yes        16-19            18 No         &lt;NA&gt;           C: Possibl…
 8       61 No         40-49            40 No         Facing Traffic B: Evident…
 9       64 Yes        6-10              6 No         Facing Traffic B: Evident…
10       67 Yes        6-10              7 No         &lt;NA&gt;           B: Evident…
# ℹ 5,706 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="rename-specific-columns" class="level2">
<h2 class="anchored" data-anchor-id="rename-specific-columns"><code>rename</code> specific columns</h2>
<p>Useful for correcting typos, and renaming to make variable names shorter and/or more informative</p>
<ul>
<li>Original names:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bike)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "FID"        "OBJECTID"   "AmbulanceR" "BikeAge_Gr" "Bike_Age"  
 [6] "Bike_Alc_D" "Bike_Dir"   "Bike_Injur" "Bike_Pos"   "Bike_Race" 
[11] "Bike_Sex"   "City"       "County"     "CrashAlcoh" "CrashDay"  
[16] "Crash_Date" "Crash_Grp"  "Crash_Hour" "Crash_Loc"  "Crash_Mont"
[21] "Crash_Time" "Crash_Type" "Crash_Ty_1" "Crash_Year" "Crsh_Sevri"
[26] "Developmen" "DrvrAge_Gr" "Drvr_Age"   "Drvr_Alc_D" "Drvr_EstSp"
[31] "Drvr_Injur" "Drvr_Race"  "Drvr_Sex"   "Drvr_VehTy" "ExcsSpdInd"
[36] "Hit_Run"    "Light_Cond" "Locality"   "Num_Lanes"  "Num_Units" 
[41] "Rd_Charact" "Rd_Class"   "Rd_Conditi" "Rd_Config"  "Rd_Defects"
[46] "Rd_Feature" "Rd_Surface" "Region"     "Rural_Urba" "Speed_Limi"
[51] "Traff_Cntr" "Weather"    "Workzone_I" "Location"  </code></pre>
</div>
</div>
<p>. . .</p>
<ul>
<li>Rename <code>Speed_Limi</code> to <code>Speed_Limit</code>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>bike <span class="ot">&lt;-</span> bike <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="fu">rename</span>(<span class="at">Speed_Limit =</span> Speed_Limi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bike)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "FID"         "OBJECTID"    "AmbulanceR"  "BikeAge_Gr"  "Bike_Age"   
 [6] "Bike_Alc_D"  "Bike_Dir"    "Bike_Injur"  "Bike_Pos"    "Bike_Race"  
[11] "Bike_Sex"    "City"        "County"      "CrashAlcoh"  "CrashDay"   
[16] "Crash_Date"  "Crash_Grp"   "Crash_Hour"  "Crash_Loc"   "Crash_Mont" 
[21] "Crash_Time"  "Crash_Type"  "Crash_Ty_1"  "Crash_Year"  "Crsh_Sevri" 
[26] "Developmen"  "DrvrAge_Gr"  "Drvr_Age"    "Drvr_Alc_D"  "Drvr_EstSp" 
[31] "Drvr_Injur"  "Drvr_Race"   "Drvr_Sex"    "Drvr_VehTy"  "ExcsSpdInd" 
[36] "Hit_Run"     "Light_Cond"  "Locality"    "Num_Lanes"   "Num_Units"  
[41] "Rd_Charact"  "Rd_Class"    "Rd_Conditi"  "Rd_Config"   "Rd_Defects" 
[46] "Rd_Feature"  "Rd_Surface"  "Region"      "Rural_Urba"  "Speed_Limit"
[51] "Traff_Cntr"  "Weather"     "Workzone_I"  "Location"   </code></pre>
</div>
</div>
</section>
<section id="practice-3" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="practice-3">Practice</h2>
<p>Your boss in Cumberland County gets overwhelmed by data easily, but he wants some data from you. He wants all bike accidents from his County, but he only wants to know the road’s speed limit, the age of the biker, and to know if alcohol was involved. If you have time, mine as well make the column names very clear to your boss while you’re at it…</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Unmute to ask or put any questions in the chat. When completed, respond to the zoom poll.</p>
</div></div></section>
<section id="arrange-to-order-rows" class="level2">
<h2 class="anchored" data-anchor-id="arrange-to-order-rows"><code>arrange</code> to order rows</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">group_by</span>(BikeAge_Gr) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">summarize</span>(<span class="at">crash_count =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(crash_count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 2
   BikeAge_Gr crash_count
   &lt;chr&gt;            &lt;int&gt;
 1 40-49              920
 2 11-15              747
 3 50-59              739
 4 20-24              680
 5 30-39              658
 6 16-19              605
 7 25-29              430
 8 6-10               421
 9 60-69              274
10 &lt;NA&gt;               112
11 0-5                 60
12 70+                 58
13 70                  12</code></pre>
</div>
</div>
</section>
<section id="count-to-group-by-then-count" class="level2">
<h2 class="anchored" data-anchor-id="count-to-group-by-then-count"><code>count</code> to group by then count</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>bike <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(BikeAge_Gr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 2
   BikeAge_Gr     n
   &lt;chr&gt;      &lt;int&gt;
 1 0-5           60
 2 11-15        747
 3 16-19        605
 4 20-24        680
 5 25-29        430
 6 30-39        658
 7 40-49        920
 8 50-59        739
 9 6-10         421
10 60-69        274
11 70            12
12 70+           58
13 &lt;NA&gt;         112</code></pre>
</div>
</div>
<p><span style="background-color: #ADD8E6"><i class="fa fa-user" aria-hidden="true"></i> &nbsp; If you wanted to arrange these in ascending order what would you add to the pipe?</span></p>
</section>
<section id="distinct-to-filter-for-unique-rows" class="level2">
<h2 class="anchored" data-anchor-id="distinct-to-filter-for-unique-rows"><code>distinct</code> to filter for unique rows</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>bike <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2"></a>  <span class="fu">select</span>(County, City) <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a href="#cb40-4"></a>  <span class="fu">arrange</span>(County, City)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 360 × 2
   County    City              
   &lt;chr&gt;     &lt;chr&gt;             
 1 Alamance  Alamance          
 2 Alamance  Burlington        
 3 Alamance  Elon College      
 4 Alamance  Gibsonville       
 5 Alamance  Graham            
 6 Alamance  Green Level       
 7 Alamance  Mebane            
 8 Alamance  None - Rural Crash
 9 Alexander None - Rural Crash
10 Alleghany None - Rural Crash
# ℹ 350 more rows</code></pre>
</div>
</div>
<p>. . .</p>
<section id="distinct-has-a-.keep_all-parameter" class="level3">
<h3 class="anchored" data-anchor-id="distinct-has-a-.keep_all-parameter"><code>distinct</code> has a .keep_all parameter</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>bike <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2"></a>  <span class="fu">distinct</span>(County, City, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="fu">arrange</span>(County, City)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 360 × 54
     FID OBJECTID AmbulanceR BikeAge_Gr Bike_Age Bike_Alc_D Bike_Dir  Bike_Injur
   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     
 1   524      525 Yes        11-15            12 No         &lt;NA&gt;      B: Eviden…
 2    84       85 Yes        20-24            20 No         With Tra… B: Eviden…
 3   571      572 Yes        16-19            16 No         Not Appl… B: Eviden…
 4   509      510 Yes        40-49            43 Yes        With Tra… K: Killed 
 5   855      856 Yes        30-39            30 No         With Tra… A: Disabl…
 6     5        6 Yes        40-49            44 Yes        With Tra… C: Possib…
 7   163      164 Yes        30-39            35 No         Not Appl… C: Possib…
 8    96       97 Yes        30-39            36 No         With Tra… C: Possib…
 9    46       47 Yes        50-59            53 No         With Tra… B: Eviden…
10   485      486 Yes        60-69            62 No         With Tra… C: Possib…
# ℹ 350 more rows
# ℹ 46 more variables: Bike_Pos &lt;chr&gt;, Bike_Race &lt;chr&gt;, Bike_Sex &lt;chr&gt;,
#   City &lt;chr&gt;, County &lt;chr&gt;, CrashAlcoh &lt;chr&gt;, CrashDay &lt;chr&gt;,
#   Crash_Date &lt;date&gt;, Crash_Grp &lt;chr&gt;, Crash_Hour &lt;dbl&gt;, Crash_Loc &lt;chr&gt;,
#   Crash_Mont &lt;chr&gt;, Crash_Time &lt;dttm&gt;, Crash_Type &lt;chr&gt;, Crash_Ty_1 &lt;dbl&gt;,
#   Crash_Year &lt;dbl&gt;, Crsh_Sevri &lt;chr&gt;, Developmen &lt;chr&gt;, DrvrAge_Gr &lt;chr&gt;,
#   Drvr_Age &lt;dbl&gt;, Drvr_Alc_D &lt;chr&gt;, Drvr_EstSp &lt;chr&gt;, Drvr_Injur &lt;chr&gt;, …</code></pre>
</div>
</div>
</section>
</section>
<section id="practice-storms" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="practice-storms">Practice: <code>storms</code></h2>
<p>There is an available dataset <code>storms</code>. Using that dataset and common <code>dplyr</code> functions, answer the following questions:</p>
<ol type="1">
<li>How many observations are there in this dataset? What is the observational unit?</li>
<li>How many unique hurricanes are included in this dataset?</li>
<li>Among all storms in this dataset, in which month are storms most common?</li>
</ol>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Unmute to ask or put any questions in the chat. When completed, respond to the zoom poll.</p>
</div></div></section>
</section>
<section id="calculating-common-metrics" class="level1 page-columns page-full" data-background-color="#e4282e">
<h1 data-background-color="#e4282e">Calculating Common Metrics</h1>
<section id="data-1" class="level2">
<h2 class="anchored" data-anchor-id="data-1">Data</h2>
<p>Using data you’re likely to encounter…by generating some fake data (used ChatGPT to generate code):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">321</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of unique patients</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>num_patients <span class="ot">&lt;-</span> <span class="dv">74000</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of observations for each patient</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>num_observations <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2</span>, num_patients)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>num_observations[<span class="fu">sample</span>(num_patients, <span class="dv">16400</span>)] <span class="ot">&lt;-</span> <span class="dv">3</span>  <span class="co"># Selecting 16400 patients with at least 3 observations</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate patient IDs</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>patient_ids <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>num_patients, num_observations)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate concentrations for two different compounds</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>compound1 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fl">0.05</span><span class="sc">:</span><span class="dv">100</span>, <span class="fu">sum</span>(num_observations), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>compound2 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fl">0.05</span><span class="sc">:</span><span class="dv">100</span>, <span class="fu">sum</span>(num_observations), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine patient IDs and compound concentrations into a data frame</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Patient_ID =</span> patient_ids,</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Compound1 =</span> compound1,</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">Compound2 =</span> compound2</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the dataset</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Patient_ID Compound1 Compound2
       &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1          1     59.0       3.05
2          1     64.0      74.0 
3          2     98.0      42.0 
4          2     19.0      25.0 
5          3      6.05      7.05
6          3     67.0      96.0 </code></pre>
</div>
</div>
</section>
<section id="step-1-filter-data" class="level2">
<h2 class="anchored" data-anchor-id="step-1-filter-data">Step 1: Filter data</h2>
<ul>
<li>Only include patients with vales &gt; 50 for <code>Compound1</code></li>
<li>Then: only include patients who have at least 3 replicates</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Compound1 <span class="sc">&gt;</span> <span class="dv">50</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Patient_ID) <span class="sc">|&gt;</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-calculate-ratios-practice" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="step-2-calculate-ratios-practice">Step 2: Calculate Ratios (Practice)</h2>
<ul>
<li>Add new column (<code>ratio12</code>) to <code>df_filtered</code> to calculate the ratio between Compound1 and Compound2</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Unmute to ask or put any questions in the chat. When completed, respond to the zoom poll.</p>
</div></div></section>
<section id="step-3-calculate-intra-patient-cv" class="level2">
<h2 class="anchored" data-anchor-id="step-3-calculate-intra-patient-cv">Step 3: Calculate intra-patient CV</h2>
<ul>
<li>carry out calculations within patient</li>
<li>determine pt mean, sd, CV</li>
<li>filter to only include CV &lt;= 10%</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the intra-patient coefficient of variation (CV)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to include only those CV &lt; 10%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>df_mean <span class="ot">&lt;-</span> df_filtered <span class="sc">|&gt;</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Patient_ID) <span class="sc">|&gt;</span> </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean =</span> <span class="fu">mean</span>(ratio12),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd =</span> <span class="fu">sd</span>(ratio12),</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">CV =</span> sd<span class="sc">/</span>mean <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CV <span class="sc">&lt;=</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-4-identify-extreme-values" class="level2">
<h2 class="anchored" data-anchor-id="step-4-identify-extreme-values">Step 4: Identify extreme values</h2>
<ul>
<li>mimicking identification of slow and fast metabolizers</li>
</ul>
<p>For “slow metabolizers:..</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate threshold</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df_mean<span class="sc">$</span>ratio12, <span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to extract the rows below the threshold</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>df_mean <span class="sc">|&gt;</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ratio12 <span class="sc">&lt;=</span> threshold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
# Groups:   Patient_ID [3]
  Patient_ID Compound1 Compound2 ratio12  mean     sd    CV
       &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1      27269      77.0      88.0   0.875 0.904 0.0271  3.00
2      29555      64.0      75.0   0.853 0.877 0.0794  9.05
3      29555      78.0      96.0   0.813 0.877 0.0794  9.05
4      65962      87.0      99.0   0.879 0.935 0.0691  7.39</code></pre>
</div>
</div>
<p>. . .</p>
<p>How many “fast metabolizers” are in this dataset, if “fast” is defined as above the 95th quartile?</p>
<p>Unmute to ask or put any questions in the chat. When completed, respond to the zoom poll.</p>
</section>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<ul>
<li><code>dplyr</code> is an incredibly powerful package for manipulating data in R
<ul>
<li>carries out common manipulation tasks</li>
<li>helpful for calculating common metrics/statistics</li>
<li>able to do this within groups</li>
</ul></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>